% !TEX encoding = UTF-8 Unicode
\documentclass{standalone}
% \usepackage{pgfplots}
% \pgfplotsset{compat=1.11}

\renewcommand{\familydefault}{\sfdefault}
% \usepackage[version=0.96]{pgf}
\usepackage{tikz}
% \usetikzlibrary{arrows,shapes,automata,backgrounds,petri,positioning}
% \usetikzlibrary{decorations.pathmorphing}
% \usetikzlibrary{decorations.shapes}
% \usetikzlibrary{decorations.text}
% \usetikzlibrary{decorations.fractals}
% \usetikzlibrary{decorations.footprints}
% \usetikzlibrary{shadows}
% \usetikzlibrary{calc}
% \usetikzlibrary{spy}

% \pgfplotsset{compat=1.11}
\usepackage[utf8]{inputenc}
% \usepackage[vietnam]{babel}



%% ========= long bar notation ==============================
\makeatletter
\newsavebox\myboxA
\newsavebox\myboxB
\newlength\mylenA
\newcommand*\lbar[2][.75]{%
    \sbox{\myboxA}{$\m@th#2$}%
    \setbox\myboxB\null% Phantom box
    \ht\myboxB=\ht\myboxA%
    \dp\myboxB=\dp\myboxA%
    \wd\myboxB=#1\wd\myboxA% Scale phantom
    \sbox\myboxB{$\m@th\overline{\copy\myboxB}$}%  Overlined phantom
    \setlength\mylenA{\the\wd\myboxA}%   calc width diff
    \addtolength\mylenA{-\the\wd\myboxB}%
    \ifdim\wd\myboxB<\wd\myboxA%
       \rlap{\hskip 0.5\mylenA\usebox\myboxB}{\usebox\myboxA}%
    \else
        \hskip -0.3\mylenA\rlap{\usebox\myboxA}{\hskip 0.3\mylenA\usebox\myboxB}%
    \fi}
\makeatother

\def\lbD{\lbar{\bD}}
\def\lbY{\lbar{\mathbf{Y}}}
\def\lbX{\lbar{\bX}}


\def\d{.9}
% \def\p{5.1}
\def\q{-.9}
% \def\sc{25}

\newcommand{\nn}[4]{
    \begin{scope}[xshift = #1*\d cm, yshift = #2*\q cm]
        
    \node at (0, 0) [anchor = east, draw, inner sep = 0, fill = #3!20, minimum height = .9cm, minimum width = .9cm] {#4};
    \end{scope}
}

\newcommand{\nnn}[4]{
    \begin{scope}[xshift = #1*\d cm, yshift = #2*\q cm]
        
    \node at (0, 0) [anchor = east, align = left,  draw, inner sep = 0, fill = #3!30, minimum height = .9cm, minimum width = .9cm] {#4};
    \end{scope}
}

\newcommand{\nb}[4]{
    \begin{scope}[xshift = #1*\d cm, yshift = #2*\q cm]
        
    \node at (0, 0) [anchor = east, align = left, inner sep = 0, fill = #3!30, minimum height = .6cm, minimum width = .6cm] {#4};
    \end{scope}
}

\begin{document}
\begin{tikzpicture}
    \begin{scope}
        % \nb{4}{8.25}{white}{\Large a) Original rating matrix $\mathbf{Y}$};

        \node [text width = 5.5cm] at (3, -7.5) {\Large a) Original rating matrix $\mathbf{Y}$ and mean user ratings.};

        \nb{.85}{6}{white}{$\downarrow$};
        \nb{1.85}{6}{white}{$\downarrow$};
        \nb{2.85}{6}{white}{$\downarrow$};
        \nb{3.85}{6}{white}{$\downarrow$};
        \nb{4.85}{6}{white}{$\downarrow$};
        \nb{5.85}{6}{white}{$\downarrow$};
        \nb{6.85}{6}{white}{$\downarrow$};


        \nn{1}{0}{white}{$\mathbf{u}_0$};
        \nn{1}{1}{green}{5};
        \nn{1}{2}{green}{3};
        \nn{1}{3}{gray}{?};
        \nn{1}{4}{green}{2};
        \nn{1}{5}{green}{2};

        \nn{2}{0}{white}{$\mathbf{u}_1$};
        \nn{2}{1}{green}{5};
        \nn{2}{2}{gray}{?};
        \nn{2}{3}{green}{4};
        \nn{2}{4}{green}{2};
        \nn{2}{5}{green}{0};

        \nn{3}{0}{white}{$\mathbf{u}_2$};
        \nn{3}{1}{green}{2};
        \nn{3}{2}{gray}{?};
        \nn{3}{3}{green}{1};
        \nn{3}{4}{green}{3};
        \nn{3}{5}{green}{4};

        \nn{4}{0}{white}{$\mathbf{u}_3$};
        \nn{4}{1}{green}{0};
        \nn{4}{2}{green}{0};
        \nn{4}{3}{gray}{?};
        \nn{4}{4}{green}{4};
        \nn{4}{5}{gray}{?};

        \nn{5}{0}{white}{$\mathbf{u}_4$};
        \nn{5}{1}{green}{1};
        \nn{5}{2}{gray}{?};
        \nn{5}{3}{gray}{?};
        \nn{5}{4}{green}{4};
        \nn{5}{5}{gray}{?};

        \nn{6}{0}{white}{$\mathbf{u}_5$};
        \nn{6}{1}{gray}{?};
        \nn{6}{2}{green}{3};
        \nn{6}{3}{green}{1};
        \nn{6}{4}{gray}{?};
        \nn{6}{5}{gray}{?};

        \nn{7}{0}{white}{$\mathbf{u}_6$};
        \nn{7}{1}{gray}{?};
        \nn{7}{2}{gray}{?};
        \nn{7}{3}{green}{2};
        \nn{7}{4}{green}{4};
        \nn{7}{5}{green}{5};



        \nnn{0}{1}{white}{$\mathbf{i}_0$};
        \nnn{0}{2}{white}{$\mathbf{i}_1$};
        \nnn{0}{3}{white}{$\mathbf{i}_2$};
        \nnn{0}{4}{white}{$\mathbf{i}_3$};
        \nnn{0}{5}{white}{$\mathbf{i}_4$};

        \nb{0}{7}{white}{$\bar{u}_j$};

        \nn{1}{7}{green}{3};
        \nn{2}{7}{green}{\small 11/4};
        \nn{3}{7}{green}{\small 5/2};
        \nn{4}{7}{green}{\small 4/3};
        \nn{5}{7}{green}{\small 5/2};
        \nn{6}{7}{green}{\small 2};
        \nn{7}{7}{green}{\small 11/3};

    \end{scope}



    \begin{scope}[xshift = 9cm]
        % \nb{4}{8.25}{white}{\Large b) $\bar{\mathbf{Y}}$};
        \node  at (3, -7.5) {\Large b) Normalized rating matrix $\bar{\mathbf{Y}}$.};
        % \nb{1}{6}{white}{$\downarrow$};
        % \nb{2}{6}{white}{$\downarrow$};
        % \nb{3}{6}{white}{$\downarrow$};
        % \nb{4}{6}{white}{$\downarrow$};
        % \nb{5}{6}{white}{$\downarrow$};
        % \nb{6}{6}{white}{$\downarrow$};
        % \nb{7}{6}{white}{$\downarrow$};


        \nn{1}{0}{white}{$\mathbf{u}_0$};
        \nn{1}{1}{green}{2};
        \nn{1}{2}{green}{0};
        \nn{1}{3}{gray}{0};
        \nn{1}{4}{green}{-1};
        \nn{1}{5}{green}{-1};

        \nn{2}{0}{white}{$\mathbf{u}_1$};
        \nn{2}{1}{green}{9/4};
        \nn{2}{2}{gray}{0};
        \nn{2}{3}{green}{5/4};
        \nn{2}{4}{green}{-3/4};
        \nn{2}{5}{green}{-11/4};

        \nn{3}{0}{white}{$\mathbf{u}_2$};
        \nn{3}{1}{green}{-1/2};
        \nn{3}{2}{gray}{0};
        \nn{3}{3}{green}{-3/2};
        \nn{3}{4}{green}{1/2};
        \nn{3}{5}{green}{3/2};

        \nn{4}{0}{white}{$\mathbf{u}_3$};
        \nn{4}{1}{green}{-4/3};
        \nn{4}{2}{green}{-4/3};
        \nn{4}{3}{gray}{0};
        \nn{4}{4}{green}{8/3};
        \nn{4}{5}{gray}{0};

        \nn{5}{0}{white}{$\mathbf{u}_4$};
        \nn{5}{1}{green}{-3/2};
        \nn{5}{2}{gray}{0};
        \nn{5}{3}{gray}{0};
        \nn{5}{4}{green}{3/2};
        \nn{5}{5}{gray}{0};

        \nn{6}{0}{white}{$\mathbf{u}_5$};
        \nn{6}{1}{gray}{0};
        \nn{6}{2}{green}{1};
        \nn{6}{3}{green}{-1};
        \nn{6}{4}{gray}{0};
        \nn{6}{5}{gray}{0};

        \nn{7}{0}{white}{$\mathbf{u}_6$};
        \nn{7}{1}{gray}{0};
        \nn{7}{2}{gray}{0};
        \nn{7}{3}{green}{-5/3};
        \nn{7}{4}{green}{1/3};
        \nn{7}{5}{green}{4/3};



        \nnn{0}{1}{white}{$\mathbf{i}_0$};
        \nnn{0}{2}{white}{$\mathbf{i}_1$};
        \nnn{0}{3}{white}{$\mathbf{i}_2$};
        \nnn{0}{4}{white}{$\mathbf{i}_3$};
        \nnn{0}{5}{white}{$\mathbf{i}_4$};

        % \nb{-.5}{7}{white}{$\|\mathbf{u}_j\|_2^2$};

        % \nn{1}{7}{green}{6};
        % \nn{2}{7}{green}{59/4};
        % \nn{3}{7}{green}{5};
        % \nn{4}{7}{green}{32/3};
        % \nn{5}{7}{green}{9/2};
        % \nn{6}{7}{green}{2};
        % \nn{7}{7}{green}{14/3};
    \end{scope}
    

    \begin{scope}[xshift = 18cm, yshift = 0cm]
        % \nb{4}{8.25}{white}{\Large c) ${\mathbf{S}}$};
        \node  at (3, -7.5) {\Large c) User similarity matrix ${\mathbf{S}}$.};

        \nn{1}{0}{white}{$\mathbf{u}_0$};
        \nn{1}{1}{blue}{1};
        \nn{1}{2}{yellow}{0.85};
        \nn{1}{3}{yellow}{-0.55};
        \nn{1}{4}{yellow}{-0.67};
        \nn{1}{5}{yellow}{-0.87};
        \nn{1}{6}{yellow}{0};
        \nn{1}{7}{yellow}{-0.31};

        \nn{2}{0}{white}{$\mathbf{u}_1$};
        \nn{2}{1}{yellow}{0.85};
        \nn{2}{2}{blue}{1};
        \nn{2}{3}{yellow}{-0.87};
        \nn{2}{4}{yellow}{-0.40};
        \nn{2}{5}{yellow}{-0.55};
        \nn{2}{6}{yellow}{-0.23};
        \nn{2}{7}{yellow}{-0.72};

        \nn{3}{0}{white}{$\mathbf{u}_2$};
        \nn{3}{1}{yellow}{-0.55};
        \nn{3}{2}{yellow}{-0.87};
        \nn{3}{3}{blue}{1};
        \nn{3}{4}{yellow}{0.27};
        \nn{3}{5}{yellow}{0.32};
        \nn{3}{6}{yellow}{0.47};
        \nn{3}{7}{yellow}{0.97};

        \nn{4}{0}{white}{$\mathbf{u}_3$};
        \nn{4}{1}{yellow}{-0.67};
        \nn{4}{2}{yellow}{-0.40};
        \nn{4}{3}{yellow}{0.27};
        \nn{4}{4}{blue}{1};
        \nn{4}{5}{yellow}{0.86};
        \nn{4}{6}{yellow}{-0.29};
        \nn{4}{7}{yellow}{0.13};

        \nn{5}{0}{white}{$\mathbf{u}_4$};
        \nn{5}{1}{yellow}{-0.87};
        \nn{5}{2}{yellow}{-0.55};
        \nn{5}{3}{yellow}{0.32};
        \nn{5}{4}{yellow}{0.87};
        \nn{5}{5}{blue}{1};
        \nn{5}{6}{yellow}{0};
        \nn{5}{7}{yellow}{0.11};

        \nn{6}{0}{white}{$\mathbf{u}_5$};
        \nn{6}{1}{yellow}{0};
        \nn{6}{2}{yellow}{-0.23};
        \nn{6}{3}{yellow}{0.47};
        \nn{6}{4}{yellow}{-0.29};
        \nn{6}{5}{yellow}{0};
        \nn{6}{6}{blue}{1};
        \nn{6}{7}{yellow}{0.55};

        \nn{7}{0}{white}{$\mathbf{u}_6$};
        \nn{7}{1}{yellow}{-0.31};
        \nn{7}{2}{yellow}{-0.72};
        \nn{7}{3}{yellow}{0.97};
        \nn{7}{4}{yellow}{0.13};
        \nn{7}{5}{yellow}{0.11};
        \nn{7}{6}{yellow}{0.55};
        \nn{7}{7}{blue}{1};

        \nnn{0}{1}{white}{$\mathbf{u}_0$};
        \nnn{0}{2}{white}{$\mathbf{u}_1$};
        \nnn{0}{3}{white}{$\mathbf{u}_2$};
        \nnn{0}{4}{white}{$\mathbf{u}_3$};
        \nnn{0}{5}{white}{$\mathbf{u}_4$};
        \nnn{0}{6}{white}{$\mathbf{u}_5$};
        \nnn{0}{7}{white}{$\mathbf{u}_6$};
    \end{scope}

    %%%%%%%%%%%%%%%%%%%%
    \begin{scope}[xshift = 0cm, yshift = -9cm]
        \nb{4}{6.25}{white}{\Large d) $\hat{\mathbf{Y}}$};
        % \node  at (3, -5.75) {\Large d) $\hat{\mathbf{Y}}$.};

        \nn{1}{0}{white}{$\mathbf{u}_0$};
        \nn{1}{1}{green}{2};
        \nn{1}{2}{green}{0};
        \nn{1}{3}{red}{5/4};
        \nn{1}{4}{green}{-1};
        \nn{1}{5}{green}{-1};

        \nn{2}{0}{white}{$\mathbf{u}_1$};
        \nn{2}{1}{green}{9/4};
        \nn{2}{2}{gray}{-0.21};
        \nn{2}{3}{green}{5/4};
        \nn{2}{4}{green}{-3/4};
        \nn{2}{5}{green}{-11/4};

        \nn{3}{0}{white}{$\mathbf{u}_2$};
        \nn{3}{1}{green}{-1/2};
        \nn{3}{2}{red}{0.15};
        \nn{3}{3}{green}{-3/2};
        \nn{3}{4}{green}{1/2};
        \nn{3}{5}{green}{3/2};

        \nn{4}{0}{white}{$\mathbf{u}_3$};
        \nn{4}{1}{green}{-4/3};
        \nn{4}{2}{green}{-4/3};
        \nn{4}{3}{gray}{-1.55};
        \nn{4}{4}{green}{8/3};
        \nn{4}{5}{red}{1.45};

        \nn{5}{0}{white}{$\mathbf{u}_4$};
        \nn{5}{1}{green}{-3/2};
        \nn{5}{2}{gray}{-4/3};
        \nn{5}{3}{gray}{-1.54};
        \nn{5}{4}{green}{3/2};
        \nn{5}{5}{red}{1.46};

        \nn{6}{0}{white}{$\mathbf{u}_5$};
        \nn{6}{1}{gray}{-1/2};
        \nn{6}{2}{green}{1};
        \nn{6}{3}{green}{-1};
        \nn{6}{4}{red}{0.41};
        \nn{6}{5}{red}{1.41};

        \nn{7}{0}{white}{$\mathbf{u}_6$};
        \nn{7}{1}{gray}{-0.60};
        \nn{7}{2}{red}{0.56};
        \nn{7}{3}{green}{-5/3};
        \nn{7}{4}{green}{1/3};
        \nn{7}{5}{green}{4/3};



        \nnn{0}{1}{white}{$\mathbf{i}_0$};
        \nnn{0}{2}{white}{$\mathbf{i}_1$};
        \nnn{0}{3}{white}{$\mathbf{i}_2$};
        \nnn{0}{4}{white}{$\mathbf{i}_3$};
        \nnn{0}{5}{white}{$\mathbf{i}_4$};

        % \nb{-.5}{7}{white}{$\|\mathbf{u}_j\|_2^2$};

        % \nn{1}{7}{green}{6};
        % \nn{2}{7}{green}{59/4};
        % \nn{3}{7}{green}{5};
        % \nn{4}{7}{green}{32/3};
        % \nn{5}{7}{green}{9/2};
        % \nn{6}{7}{green}{2};
        % \nn{7}{7}{green}{14/3};
    \end{scope}

    \begin{scope}[xshift = 9cm, yshift = -9cm]
        \nb{4}{6.25}{white}{\Large e) Full ${\mathbf{Y}}$};

        \nn{1}{0}{white}{$\mathbf{u}_0$};
        \nn{1}{1}{green}{5};
        \nn{1}{2}{green}{3};
        \nn{1}{3}{gray}{4.25};
        \nn{1}{4}{green}{2};
        \nn{1}{5}{green}{2};

        \nn{2}{0}{white}{$\mathbf{u}_1$};
        \nn{2}{1}{green}{5};
        \nn{2}{2}{gray}{2.54};
        \nn{2}{3}{green}{4};
        \nn{2}{4}{green}{2};
        \nn{2}{5}{green}{0};

        \nn{3}{0}{white}{$\mathbf{u}_2$};
        \nn{3}{1}{green}{2};
        \nn{3}{2}{gray}{2.65};
        \nn{3}{3}{green}{1};
        \nn{3}{4}{green}{3};
        \nn{3}{5}{green}{4};

        \nn{4}{0}{white}{$\mathbf{u}_3$};
        \nn{4}{1}{green}{0};
        \nn{4}{2}{green}{0};
        \nn{4}{3}{gray}{-0.22};
        \nn{4}{4}{green}{4};
        \nn{4}{5}{gray}{2.78};

        \nn{5}{0}{white}{$\mathbf{u}_4$};
        \nn{5}{1}{green}{1};
        \nn{5}{2}{gray}{1.17};
        \nn{5}{3}{gray}{0.96};
        \nn{5}{4}{green}{4};
        \nn{5}{5}{gray}{3.96};

        \nn{6}{0}{white}{$\mathbf{u}_5$};
        \nn{6}{1}{gray}{1.5};
        \nn{6}{2}{green}{3};
        \nn{6}{3}{green}{1};
        \nn{6}{4}{gray}{2.41};
        \nn{6}{5}{gray}{3.41};

        \nn{7}{0}{white}{$\mathbf{u}_6$};
        \nn{7}{1}{gray}{3.06};
        \nn{7}{2}{gray}{4.22};
        \nn{7}{3}{green}{2};
        \nn{7}{4}{green}{4};
        \nn{7}{5}{green}{5};



        \nnn{0}{1}{white}{$\mathbf{i}_0$};
        \nnn{0}{2}{white}{$\mathbf{i}_1$};
        \nnn{0}{3}{white}{$\mathbf{i}_2$};
        \nnn{0}{4}{white}{$\mathbf{i}_3$};
        \nnn{0}{5}{white}{$\mathbf{i}_4$};

        % \nb{0}{7}{white}{$\bar{u}_j$};

        % \nn{1}{7}{green}{3};
        % \nn{2}{7}{green}{\small 11/4};
        % \nn{3}{7}{green}{\small 5/2};
        % \nn{4}{7}{green}{\small 4/3};
        % \nn{5}{7}{green}{\small 5/2};
        % \nn{6}{7}{green}{\small 2};
        % \nn{7}{7}{green}{\small 11/3};

    \end{scope}
\end{tikzpicture}
\end{document}