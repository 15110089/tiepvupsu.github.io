<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Bài 5: K-means Clustering: Simple Applications</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="">
    <link rel="canonical" href="http://localhost:4000/2017/01/04/kmeans2/">
    <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Machine Learning cơ bản posts" />
    <!-- <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /> -->
    <!-- <link rel="icon" type="image/x-icon" href="favicon.ico" sizes="16x16"> -->
    <!-- <link rel="icon" type="image/png" href="http://earlystudios.altervista.org/images/ai.png" sizes="16x16"> -->
    <link rel="icon" type="image/png" href="https://www.highspot.com/wp-content/uploads/icon-intelligent-recommendations.png" sizes="32x32">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
         <!-- Google Analytics -->
      
      <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KTCD8BX');</script>
<!-- End Google Tag Manager -->
</head>

 
    
    <body>
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KTCD8BX"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->



    <header class="site-header">

  <div class="wrap">

    <div style="float:left; margin-top:10px; margin-right:10px;">
    <a href="/feed.xml">
      <img src="/assets/rssicon.svg" width="40">
    </a>
    </div>

    <a class="site-title" href="/">Machine Learning cơ bản</a>
    
    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
          <a class="page-link" href="/about/">About</a>
        
          
        
          
        
          <a class="page-link" href="/index/">Index</a>
        
          <a class="page-link" href="/math/">Math</a>
        
          
        
          <a class="page-link" href="/subscribe/">Subscribe</a>
        
          <a class="page-link" href="/tags">Tags</a>
        
      </div>
    </nav>
  </div>
</header>



    <div class="page-content">
      <div class="wrap">
      <div class="PageNavigation">
  
    <a class="prev" href="/2017/01/01/kmeans/">&laquo; Bài 4: K-means Clustering</a>
  
  
    <a class="next" href="/2017/01/08/knn/">Bài 6: K-nearest neighbors &raquo;</a>
  
</div>
  <header>    
  <!-- title -->
     <p style = "font-size: 27px; text-align: left">Bài 5: K-means Clustering: Simple Applications</p>
  <!-- title -->
  </header>

  <!-- tags -->
  <!--   <span style = "text-align: left">
   
   
      <a href="/tags#Clustering" class="tag">Clustering</a>
    
      <a href="/tags#Kmeans" class="tag">Kmeans</a>
    
      <a href="/tags#Unsupervised-learning" class="tag">Unsupervised-learning</a>
    
      <a href="/tags#MNIST" class="tag">MNIST</a>
    
  
    </span> -->

         
        <!-- |      -->
        <ul class="tags">
          
            <!-- <li> -->
            <a href="/tags#Clustering" class="tag">Clustering</a>
            <!-- </li> -->
          
            <!-- <li> -->
            <a href="/tags#Kmeans" class="tag">Kmeans</a>
            <!-- </li> -->
          
            <!-- <li> -->
            <a href="/tags#Unsupervised-learning" class="tag">Unsupervised-learning</a>
            <!-- </li> -->
          
            <!-- <li> -->
            <a href="/tags#MNIST" class="tag">MNIST</a>
            <!-- </li> -->
          
          </ul>
        
  <!-- tags -->
  <!-- date -->
   <p class="meta" style = "color: #818181">Jan 4, 2017 

    <!-- Start of StatCounter Code for Default Guide -->
           <!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=11213320; 
var sc_invisible=0; 
var sc_security="cfec1432"; 
var sc_text=2; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("(<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'> </"+"script>visits)");
</script>
<noscript><div class="statcounter"><a title="web analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/11213320/0/cfec1432/0/" alt="web
analytics"></a> </div></noscript>
<!-- End of StatCounter Code for Default Guide -->
    <!-- End of StatCounter Code for Default Guide -->

   <!-- 2868  -->
  </p>
  <!-- date -->

<div class="post">
  <article class="post-content">
  <!-- <div class="imgcap">
<div >
<a href = "/2017/01/04/kmeans2/">
    <img src ="/assets/kmeans/girl_all.png"  width = "800"></a>
</div>
<div class="thecap"> Nén ảnh đơn giản với K-means clustering<br></div>
</div> -->

<p>Trong bài này, tôi sẽ áp dụng thuật toán <a href="/2017/01/01/kmeans/">K-means clustering</a> vào ba bài toán xử lý ảnh thực tế hơn: i) Phân nhóm các chữ số viết tay, ii) Tách vật thể (image segmentation) và iii) Nén ảnh/dữ liệu (image compression). Qua đây, tôi cũng muốn độc giả  làm quen với một số kỹ thuật đơn giản trong xử lý hình ảnh - một mảng quan trọng trong Machine Learning. Souce code cho các ví dụ trong trang này có thể được tìm thấy <a href="https://github.com/tiepvupsu/tiepvupsu.github.io/blob/master/assets/kmeans/Kmeans2.ipynb">tại đây</a>.</p>

<p><strong>Cảnh báo:</strong> <em>bài này không có nhiều toán.</em></p>

<p><strong>Trong trang này:</strong>
<!-- MarkdownTOC --></p>

<ul>
  <li><a href="#-phan-nhom-chu-so-viet-tay">1. Phân nhóm chữ số viết tay</a>
    <ul>
      <li><a href="#bo-co-so-du-lieu-mnist">Bộ cơ sở dữ liệu MNIST</a></li>
      <li><a href="#bai-toan-phan-nhom-gia-dinh">Bài toán phân nhóm giả định</a></li>
      <li><a href="#lam-viec-tren-python">Làm việc trên Python</a></li>
    </ul>
  </li>
  <li><a href="#-object-segmentation-tach-vat-the-trong-anh">2. Object Segmentation (tách vật thể trong ảnh)</a>
    <ul>
      <li><a href="#dat-van-de">Đặt vấn đề</a></li>
      <li><a href="#len-y-tuong">Lên ý tưởng</a></li>
      <li><a href="#lam-viec-tren-python-1">Làm việc trên Python</a></li>
    </ul>
  </li>
  <li><a href="#-image-compression-nen-anh-va-nen-du-lieu-noi-chung">3. Image Compression (nén ảnh và nén dữ liệu nói chung)</a></li>
  <li><a href="#-thao-luan">4. Thảo luận</a></li>
  <li><a href="#-souce-code">5. Souce code</a></li>
  <li><a href="#-tai-lieu-tham-khao">6. Tài liệu tham khảo</a></li>
</ul>

<!-- /MarkdownTOC -->

<!-- ========================== New Heading ==================== -->
<p><a name="-phan-nhom-chu-so-viet-tay"></a></p>

<h2 id="1-phân-nhóm-chữ-số-viết-tay">1. Phân nhóm chữ số viết tay</h2>
<!-- ========================== New Heading ==================== -->
<p><a name="bo-co-so-du-lieu-mnist"></a></p>

<h3 id="bộ-cơ-sở-dữ-liệu-mnist">Bộ cơ sở dữ liệu MNIST</h3>
<p><a href="http://yann.lecun.com/exdb/mnist/">Bộ cơ sở dữ liệu MNIST</a> là bộ cơ sở dữ liệu lớn nhất về chữ số viết tay và được sử dụng trong hầu hết các thuật toán nhận dạng hình ảnh (Image Classification).</p>

<p>MNIST bao gồm hai tập con: tập dữ liệu huấn luyện (training set) có tổng cộng 60k ví dụ khác nhau về chữ số viết tay từ 0 đên 9, tập dữ liệu kiểm tra (test set) có 10k ví dụ khác nhau. Tất cả đều đã được gán nhãn. Hình dưới đây là ví dụ về một số hình ảnh được trích ra từ MNIST.</p>

<div class="imgcap">
<!-- <a href = "http://www.rubylab.io/img/mnist.png"> -->
    <img src="http://www.rubylab.io/img/mnist.png" width="800" />
    <!-- <img src="/assets/rl/mdp.png" height="206"> -->
<!-- </div> -->
<div class="thecap"><a href="http://yann.lecun.com/exdb/mnist/">MNIST</a>: bộ cơ sở dữ liệu của chữ số viết tay. <br /> (Nguồn: <a href="http://www.rubylab.io/2015/03/18/simple-neural-network-implenentation-in-ruby/">Simple Neural Network implementation in Ruby)</a></div>
</div>

<p>Mỗi bức ảnh là một ảnh đen trắng (có 1 channel), có kích thước 28x28 pixel (tổng cộng 784 pixels). Mỗi pixel mang một giá trị là một số tự nhiên từ 0 đến 255. Các pixel màu đen có giá trị bằng 0, các pixel càng trắng thì có giá trị càng cao (nhưng không quá 255). Dưới đây là một ví dụ về chữ số 7 và giá trị các pixel của nó. (<em>Vì mục đích hiển thị ma trận pixel ở bên phải, tôi đã resize bức ảnh về 14x14</em>)</p>

<div class="imgcap">
<img src="/assets/kmeans/digit_7.png" align="center" />
</div>

<!-- ========================== New Heading ==================== -->
<p><a name="bai-toan-phan-nhom-gia-dinh"></a></p>

<h3 id="bài-toán-phân-nhóm-giả-định">Bài toán phân nhóm giả định</h3>
<p><strong>Bài toán: Giả sử rằng chúng ta không biết nhãn của các chữ số này, chúng ta muốn phân nhóm các bức ảnh gần giống nhau về một nhóm.</strong></p>

<p>Lại thêm một giả sử nữa là chúng ta mới chỉ biết tới thuật toán phân nhóm <a href="/2017/01/01/kmeans/">K-means clustering</a> gần đây từ blog <a href="https://tiepvupsu.github.io/">Machine Learning cơ bản</a> (<em>xin lỗi độc giả vì để các bài học có ý nghĩa hơn, chúng ta đôi khi cần những giả định không được thực tế cho lắm</em>), chúng ta sẽ giải quyết bài toán này thế nào?</p>

<p>Trước khi áp dụng thuật toán <a href="/2017/01/01/kmeans/">K-means clustering</a>, chúng ta cần coi mỗi bức ảnh là một điểm dữ liệu. Và vì mỗi điểm dữ liệu là 1 vector (hàng hoặc cột) chứ không phải ma trận như số 7 ở trên, chúng ta phải làm thêm một bước đơn giản trung gian gọi là <em>vectorization</em> (vector hóa). Nghĩa là, để có được 1 vector, ta có thể tách các hàng của ma trận pixel ra, sau đó đặt chúng cạnh nhau, và chúng ta được một vector hàng rất dài biểu diễn 1 bức ảnh chữ số.</p>

<p><strong>Chú ý</strong>: <em>Cách làm này chỉ là cách đơn giản nhất để mô tả dữ liệu ảnh bằng 1 vector. Trên thực tế, người ta áp dụng rất nhiều kỹ thuật khác nhau để có thể tạo ra các vector đặc trưng (feature vector) giúp các thuật toán có được kết quả tốt hơn.</em></p>

<!-- ========================== New Heading ==================== -->
<p><a name="lam-viec-tren-python"></a></p>

<h3 id="làm-việc-trên-python">Làm việc trên Python</h3>
<p>Trước tiên các bạn vào trang chủ của MNIST để <a href="http://yann.lecun.com/exdb/mnist/">download</a> bộ cơ sở dữ liệu này. Trong bài này chúng ta chỉ dùng bộ dữ liệu tét với 10k ảnh và không cần label nên các bạn chỉ cần download file <code class="highlighter-rouge">t10k-images-idx3-ubyte.gz</code></p>

<p><strong>Trước tiên chúng ta cần khai báo một số thư viện:</strong></p>

<p><code class="highlighter-rouge">numpy</code> cho các phép toán liên quan đến ma trận. <code class="highlighter-rouge">mnist</code> để đọc dữ liệu từ MNIST. <code class="highlighter-rouge">matplotlib</code> để hiển thị hình vẽ. <code class="highlighter-rouge">sklearn</code> chính là <code class="highlighter-rouge">scikit-learn</code> mà chúng ta đã làm quen trong các bài trước. (<em>Về việc cài đặt các thư viện này, tôi hy vọng bạn đọc có thể Google thêm đôi chút. Nếu có khó khăn trong việc cài đặt, hãy để lại comment ở dưới bài. Lưu ý, làm việc trên Windows sẽ khó khăn hơn một chút so với Linux</em>)</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># %reset</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span> 
<span class="kn">from</span> <span class="nn">mnist</span> <span class="kn">import</span> <span class="n">MNIST</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
</code></pre>
</div>

<p>Để hiện thị nhiều bức ảnh các chữ số cùng một lúc, tôi có dùng thêm hàm số <a href="https://github.com/tiepvupsu/tiepvupsu.github.io/blob/master/assets/kmeans/display_network.py"><code class="highlighter-rouge">display_network.py</code></a>.</p>

<p><strong>Thực hiện thuật toán K-means clustering trên toàn bộ 10k chữ số.</strong></p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">display_network</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">mndata</span> <span class="o">=</span> <span class="n">MNIST</span><span class="p">(</span><span class="s">'../MNIST/'</span><span class="p">)</span> <span class="c"># path to your MNIST folder </span>
<span class="n">mndata</span><span class="o">.</span><span class="n">load_testing</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">mndata</span><span class="o">.</span><span class="n">test_images</span>

<span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">K</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">pred_label</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</code></pre>
</div>

<p>(<em>Phần còn lại của source code có thể được tìm thấy <a href="https://github.com/tiepvupsu/tiepvupsu.github.io/blob/master/assets/kmeans/Kmeans2.ipynb">tại đây</a></em>)</p>

<p>Đến đây, sau khi đã tìm được các center và phân nhóm dữ liệu vào từng cluster, tôi muốn hiển thị xem center trông như thế nào và các bức ảnh được phân vào mỗi cluster có giống nhau hay không. Dưới đây là kết quả khi tôi chọn ngẫu nhiên 20 bức ảnh từ mỗi cluster.</p>

<!-- ![png](output_7_0.png) -->
<div class="imgcap">
<img src="/assets/kmeans/kmeans_random.png" align="center" />
<div class="thecap">Áp dụng K-means clustering vào tập test set của bộ cơ sở dữ liệu MNIST với K = 10 cluster. Cột 1: centers của các cluster. Các cột còn lại: Mỗi hàng là 20 điểm dữ liệu ngẫu nhiên được chọn ra từ mỗi cluster.
</div>
</div>
<p>Mỗi hàng tương ứng với một cluster, cột đầu tiên có nền xanh bên trái là centers tìm được của các clusters (màu đỏ hơn là các pixel có giá trị cao hơn). Chúng ta thấy rằng các center đều hoặc là giống với một chữ số nào đó, hoặc là kết hợp của hai/ba chữ số nào đó. Ví dụ: center của nhóm thứ 4 là sự kết hợp của các số 4, 7, 9; của hàng thứ 7 là kết hợp của chữ số 7, 8 và 9.</p>

<p>Tuy nhiên, các bức ảnh lấy ra ngẫu nhiên từ mỗi nhóm trông không thực sự giống nhau. Lý do có thể là những bức ảnh này ở xa các center của mỗi nhóm (mặc dù center đó đã là gần nhất). Như vậy thuật toán K-means clustering làm việc không thực sự tốt trong trường hợp này. (<em>Thật may là vì thế nên chúng ta vẫn còn nhiều thứ để học nữa</em>).</p>

<p>Chúng ta vẫn có thể khai thác một số thông tin hữu ích sau khi thực hiện thuật toán này. Bây giờ, thay vì chọn ngẫu nhiên các bức ảnh trong mỗi cluster, tôi chọn 20 bức ảnh gần center của mỗi cluster nhất, vì càng gần center thì độ tin cậy càng cao. Hãy xem hình dưới đây:</p>

<div class="imgcap">
<img src="/assets/kmeans/kmeans_knn.png" align="center" />
<div class="thecap">Áp dụng K-means clustering vào tập test set của bộ cơ sở dữ liệu MNIST với K = 10 cluster. Cột 1: centers của các cluster. Các cột còn lại: Mỗi hàng là 20 điểm dữ liệu gần center nhất của mỗi cluster.
</div>
</div>

<p>Bạn đọc có thể thấy dữ liệu trong mỗi hàng khá giống nhau và giống với center ở cột đầu tiên bên trái. Có một vài quan sát thú vị có thể rút ra từ đây:</p>

<ol>
  <li>
    <p>Có hai kiểu viết chữ số 1, một thẳng, một chéo. Và K-means clustering nghĩ rằng đó là hai chữ số khác nhau. Điều này là dễ hiểu vì K-means clustering là thuật toán <a href="/2016/12/27/categories/#unsupervised-learning-hoc-khong-giam-sat">Unsupervised learning</a>. Nếu có sự can thiệp của con người, chúng ta có thể nhóm hai clusters này vào làm một.</p>
  </li>
  <li>
    <p>Hàng số 9, chữ số 4 và 9 được phân vào cùng 1 cluster. Sự thật là hai chữ số này cũng khá giống nhau. Điều tương tự xảy ra đối với hàng số 7 với các chữ số 7, 8, 9 được xếp vào 1 cluster. Với các cluster này, chúng ta có thể tiếp tục áp dụng K-means clustering để phân nhỏ cluster đó ra.</p>
  </li>
  <li>
    <p>Trong clustering có một kỹ thuật thường được sử dụng là <a href="https://en.wikipedia.org/wiki/Hierarchical_clustering">Hierarchical clustering (clustering phân tầng )</a>. Có hai loại Hierachical clustering:</p>

    <ul>
      <li>
        <p><strong>Agglomerative</strong> tức “đi từ dưới lên”. Ban đầu coi mỗi điểm dữ liệu thuộc 1 cluster khác nhau, sau đó các cặp cluster gần giống nhau được gộp lại làm một cluster lớn hơn. Lặp lại quá trình này đến khi nhận được kết quả chấp nhận được.</p>
      </li>
      <li>
        <p><strong>Divisive</strong> tức “đi từ trên xuống”. Ban đầu coi tất cả các điểm dữ liệu thuộc cùng một cluster, sau đó chia nhỏ mỗi cluster bằng một thuật toán clustering nào đó.</p>
      </li>
    </ul>
  </li>
</ol>

<!-- ========================== New Heading ==================== -->
<p><a name="-object-segmentation-tach-vat-the-trong-anh"></a></p>

<h2 id="2-object-segmentation-tách-vật-thể-trong-ảnh">2. Object Segmentation (tách vật thể trong ảnh)</h2>
<!-- ========================== New Heading ==================== -->
<p><a name="dat-van-de"></a></p>

<h3 id="Đặt-vấn-đề">Đặt vấn đề</h3>
<p>Chúng ta cùng thử áp dụng thuật toán K-means clustering vào một bài toán xử lý ảnh khác: tách vật thể.</p>

<p>Giả sử chúng ta có bức ảnh dưới đây và muốn một thuật toán tự động nhận ra vùng khuôn mặt và tách nó ra.</p>

<div class="imgcap">
<img src="/assets/kmeans/girl3.jpg" align="center" />
<div class="thecap">Credit ảnh: <a href="https://www.facebook.com/photo.php?fbid=1219980151402370&amp;set=a.113129725420757.13101.100001711890571&amp;type=3&amp;theater"> Trọng Vũ</a>
</div>
</div>

<!-- ========================== New Heading ==================== -->
<p><a name="len-y-tuong"></a></p>

<h3 id="lên-ý-tưởng">Lên ý tưởng</h3>
<p>(<em>Lại giả sử rằng chúng ta chưa biết gì khác ngoài K-means clustering, các bạn hãy dừng vài giây để nghĩ xem chúng ta có thể xử lý thế nào. Gợi ý: Có ba màu chủ đạo trong bức ảnh.</em>)</p>

<p>Ok, có ba màu, ba clusters!</p>

<p>Bức ảnh có ba màu chủ đạo: hồng ở khăn và môi; đen ở mắt, tóc, và hậu cảnh; màu da ở vùng còn lại của khuôn mặt. Vậy chúng ta có thể áp dụng thuật toán K-means clustering để phân các pixel ảnh thành 3 clusters, sau đó chọn cluster chứa phần khuôn mặt (phần này do con người làm).</p>

<p>Đây là một bức ảnh màu, mỗi điểm ảnh sẽ được biểu diễn bới 3 giá trị tương ứng với màu Red, Green, và Blue (mỗi giá trị này cũng là một số tự nhiên không vượt quá 255). Nếu ta coi mỗi điểm dữ liệu là một vector 3 chiều chứa các giá trị này, sau đó áp dụng thuật toán K-means clustering, chúng ta có thể có kết quả mong muốn. Hãy thử xem</p>

<!-- ========================== New Heading ==================== -->
<p><a name="lam-viec-tren-python-1"></a></p>

<h3 id="làm-việc-trên-python-1">Làm việc trên Python</h3>

<p><strong>Khai báo thư viện và load bức ảnh:</strong></p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="kn">as</span> <span class="nn">mpimg</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s">'girl3.jpg'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">imgplot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
</code></pre>
</div>

<p><strong>Biến đổi bức ảnh thành 1 ma trận mà mỗi hàng là 1 pixel với 3 giá trị màu</strong></p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">X</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</code></pre>
</div>

<p>(<em>Phần còn lại của source code có thể xem <a href="https://github.com/tiepvupsu/tiepvupsu.github.io/blob/master/assets/kmeans/Kmeans2.ipynb">tại đây</a></em>).</p>

<p>Sau khi tìm được các cluster, tôi thay giá trị của mỗi pixel bằng center của cluster chứa nó, và được kết quả như sau:</p>
<div class="imgcap">
<img src="/assets/kmeans/girl_seg.png" align="center" />
</div>

<p>Ba màu: Hồng, đen, và màu da đã được phân nhóm. Và khuôn mặt có thể được tách ra từ phần có màu da (và vùng bên trong nó). Vậy là K-means clustering tạo ra một kết quả chấp nhận được.</p>

<!-- ========================== New Heading ==================== -->
<p><a name="-image-compression-nen-anh-va-nen-du-lieu-noi-chung"></a></p>

<h2 id="3-image-compression-nén-ảnh-và-nén-dữ-liệu-nói-chung">3. Image Compression (nén ảnh và nén dữ liệu nói chung)</h2>

<p>Để ý thấy rằng mỗi một pixel có thể nhận một trong số \(256^3 = 16,777,216\) (16 triệu màu mà chúng ta vẫn nghe khi quảng cáo màn hình). Đây là một số rất lớn (tương đương với 24 bit cho một điểm ảnh). Nếu ta muốn lưu mỗi điểm ảnh với một số bit nhỏ hơn và chấp nhận mất dữ liệu ở một mức nào đó, có cách nào không nếu ta chỉ biết K-means clustering?</p>

<p>Câu trả lời là có. Trong bài toán Segmentation phía trên, chúng ta có 3 clusters, và mỗi một điểm ảnh sau khi xử lý sẽ được biểu diễn bởi 1 số tương ứng với 1 cluster. Tuy nhiên, chất lượng bức ảnh rõ ràng đã giảm đi nhiều. Tôi làm một thí nghiệm nhỏ với số lượng clusters được tăng lên là 5, 10, 15, 20. Sau khi tìm được centers cho mỗi cluster, tôi thay giá trị của một điểm ảnh bằng giá trị của center tương ứng:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]:</span>
    <span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">K</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">img4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="c"># replace each pixel by its center</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
        <span class="n">img4</span><span class="p">[</span><span class="n">label</span> <span class="o">==</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="c"># reshape and display output image</span>
    <span class="n">img5</span> <span class="o">=</span> <span class="n">img4</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img5</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">'nearest'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>
</div>

<p>Kết quả:</p>

<div class="imgcap">
<img src="/assets/kmeans/girl_all.png" align="center" />
</div>

<p>Bạn đọc có thể quan sát là khi số lượng clusters tăng lên, chất lượng bức ảnh đã được cải thiện. Đồng thời, chúng ta chỉ cần lưu các centers và label của mỗi điểm ảnh là đã có được một bức ảnh nén (có mất dữ liệu).</p>

<!-- ========================== New Heading ==================== -->
<p><a name="-thao-luan"></a></p>

<h2 id="4-thảo-luận">4. Thảo luận</h2>
<ol>
  <li>
    <p>Với một thuật toán K-means clustering đơn giản, chúng ta đã có thể áp dụng nó vào các bài toán thực tế. Mặc dù kết quả chưa thực sự như ý, chúng ta vẫn thấy được tiềm năng của thuật toán đơn giản này.</p>
  </li>
  <li>
    <p>Cách thay một điểm dữ liệu bằng center tương ứng là một trong số các kỹ thuật có tên chung là <a href="https://en.wikipedia.org/wiki/Vector_quantization">Vector Quantization (VQ)</a>. Không chỉ trong nén dữ liệu, VQ còn được áp dụng rộng rãi trong các thuật toán tạo Feature Vector cho các bài toán Phân loại (classification).</p>
  </li>
  <li>
    <p>Các thuật toán trong bài toán này được áp dụng cho xử lý ảnh vì việc này giúp tôi dễ dàng minh họa kết quả hơn. Các kỹ thuật này hoàn toàn có thể áp dụng cho các loại cơ sở dữ liệu khác.</p>
  </li>
</ol>

<!-- ========================== New Heading ==================== -->
<p><a name="-souce-code"></a></p>

<h2 id="5-souce-code">5. Souce code</h2>
<p>Các bạn có thể <a href="https://github.com/tiepvupsu/tiepvupsu.github.io/blob/master/assets/kmeans/Kmeans2.ipynb">download source code ở đây</a>.</p>

<!-- ========================== New Heading ==================== -->
<p><a name="-tai-lieu-tham-khao"></a></p>

<h2 id="6-tài-liệu-tham-khảo">6. Tài liệu tham khảo</h2>

<p><a href="http://users.isr.ist.utl.pt/~wurmd/Livros/school/Bishop%20-%20Pattern%20Recognition%20And%20Machine%20Learning%20-%20Springer%20%202006.pdf">Pattern Recognition and Machine Learning - Christopher Bishop</a></p>

  </article>

  <!-- mathjax -->
  <!--  -->
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <!--  -->
  
  <hr>
  <div class="share-page">
    <b>Share this on:</b>  <br>

    <!-- Facebook -->
    <a href="https://facebook.com/sharer.php?u=http://localhost:4000/2017/01/04/kmeans2/" rel="nofollow" target="_blank" title="Share on Facebook"><img src = "/assets/images/facebook.png" width="40"></a>

    <!-- Twitter -->
    <a href="https://twitter.com/intent/tweet?text=Bài 5: K-means Clustering: Simple Applications&url=http://localhost:4000/2017/01/04/kmeans2/&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter" width="40" ><img src = "/assets/images/twitter.png" width="40"></a>

    <!-- Google -->
    <a href="https://plus.google.com/share?url=http://localhost:4000/2017/01/04/kmeans2/" rel="nofollow" target="_blank" title="Share on Google+"><img src = "/assets/images/google.png" width="40"></a>

    
    <!-- LinkedIn -->
    <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:4000/2017/01/04/kmeans2/" target="_blank">
        <img src="/assets/images/linkedin.png" alt="LinkedIn" width="40"/>
    </a>

    <!-- Email -->
    <a href="mailto:?Subject=Simple Share Buttons&amp;Body=I%20saw%20this%20and%20thought%20of%20you!%20 http://localhost:4000/2017/01/04/kmeans2/">
        <img src="/assets/images/email.png" alt="Email" width="40"/>
    </a>
    <!-- Print -->
    <a href="javascript:;" onclick="window.print()">
        <img src="/assets/images/print.png" alt="Print" width="40"/>
    </a>
    <br>
    <b>Follow us:</b> <br>
    <a href = "https://www.facebook.com/machinelearningbasicvn/" target="_blank" title="Follow us"><img src = "/assets/images/facebook.png" width="40"></a>
</div>


  <!-- previous and next posts -->
<div class="PageNavigation">
  
    <a class="prev" href="/2017/01/01/kmeans/">&laquo; Bài 4: K-means Clustering</a>
  
  
    <a class="next" href="/2017/01/08/knn/">Bài 6: K-nearest neighbors &raquo;</a>
  
</div>


  <!-- disqus comments -->
<!--  -->
  
<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname  = 'tiepvu';
  var disqus_identifier = '/2017/01/04/kmeans2/';

  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


    <script id="dsq-count-scr" src="//tiepvu.disqus.com/count.js" async></script>

<!-- disqus comments -->
<!--  
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = "http://localhost:4000/2017/01/04/kmeans2/";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = "/2017/01/04/kmeans2"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//tiepvu.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
   -->
<!--  -->

</div>


      </div>
    </div>

    <footer class="site-footer">



  <div class="wrap">

    <!-- <h2 class="footer-heading">Machine Learning cơ bản</h2> -->

    <div class="footer-col-1 column">
      <ul>
        <li>Machine Learning cơ bản</li>
        <!-- <li><a href="mailto:vuhuutiep@gmail.com">vuhuutiep@gmail.com</a></li> -->
      </ul>
    </div>

    <div class="footer-col-2 column">
      <ul>
        <li>
          <a href="https://github.com/tiepvupsu">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <span class="username">tiepvupsu</span>
          </a>
        </li>
        
      </ul>
    </div>

    <div class="footer-col-3 column">
      <p class="text"></p>
    </div>

  </div>

</footer>

     <!-- <script id="dsq-count-scr" src="//tiepvu.disqus.com/count.js" async></script> -->

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=11206292; 
var sc_invisible=1; 
var sc_security="37333da0"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="website
statistics" href="http://statcounter.com/"
target="_blank"><img class="statcounter"
src="//c.statcounter.com/11206292/0/37333da0/1/"
alt="website statistics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->

  <script id="dsq-count-scr" src="//tiepvu.disqus.com/count.js" async></script>
    </body>
</html>